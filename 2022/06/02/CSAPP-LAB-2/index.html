<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>CSAPP Lab2 Defusing a Binary Bomb - Blowin&#039; in the Wind</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Welcome to H&#039;s Blog"><meta name="msapplication-TileImage" content="/img/kitty.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Welcome to H&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="由于实验需要在 x86-64 环境下使用，因此我不得不放弃使用 m1 芯片的 mac 转而使用 win10 在虚拟机上跑了个 centos，这里用 vmware 安装好后，再在 centos 上安装 GDB 即可。"><meta property="og:type" content="blog"><meta property="og:title" content="CSAPP Lab2 Defusing a Binary Bomb"><meta property="og:url" content="https://zion4h.github.io/2022/06/02/CSAPP-LAB-2/"><meta property="og:site_name" content="Blowin&#039; in the Wind"><meta property="og:description" content="由于实验需要在 x86-64 环境下使用，因此我不得不放弃使用 m1 芯片的 mac 转而使用 win10 在虚拟机上跑了个 centos，这里用 vmware 安装好后，再在 centos 上安装 GDB 即可。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/zion4h/picture-home@main/img251.jpg"><meta property="article:published_time" content="2022-06-02T04:00:00.000Z"><meta property="article:modified_time" content="2025-04-19T08:22:12.037Z"><meta property="article:author" content="zion h4"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://cdn.jsdelivr.net/gh/zion4h/picture-home@main/img251.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://zion4h.github.io/2022/06/02/CSAPP-LAB-2/"},"headline":"CSAPP Lab2 Defusing a Binary Bomb","image":["https://cdn.jsdelivr.net/gh/zion4h/picture-home@main/img251.jpg"],"datePublished":"2022-06-02T04:00:00.000Z","dateModified":"2025-04-19T08:22:12.037Z","author":{"@type":"Person","name":"zion h4"},"publisher":{"@type":"Organization","name":"Blowin' in the Wind","logo":{"@type":"ImageObject","url":"https://zion4h.github.io/img/kitty.png"}},"description":"由于实验需要在 x86-64 环境下使用，因此我不得不放弃使用 m1 芯片的 mac 转而使用 win10 在虚拟机上跑了个 centos，这里用 vmware 安装好后，再在 centos 上安装 GDB 即可。"}</script><link rel="canonical" href="https://zion4h.github.io/2022/06/02/CSAPP-LAB-2/"><link rel="alternate" href="https://zion4h.github.io/atom.xml" title="Blowin&#039; in the Wind" type="application/atom+xml"><link rel="icon" href="/img/kitty.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/mono-blue.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?a9f2a7370cea3cc47e78ce7e91a24ccc";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><meta name="msvalidate.01" content="E57A0E10BC15ABA0F469F0806A5EDEB0"><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-PB49LZ7RGB" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-PB49LZ7RGB');</script><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/kitty.png" alt="Blowin&#039; in the Wind" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/zion4h"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="https://cdn.jsdelivr.net/gh/zion4h/picture-home@main/img251.jpg" alt="CSAPP Lab2 Defusing a Binary Bomb"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-06-02T04:00:00.000Z" title="6/2/2022, 12:00:00 PM">2022-06-02</time>发表</span><span class="level-item"><time dateTime="2025-04-19T08:22:12.037Z" title="4/19/2025, 4:22:12 PM">2025-04-19</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a><span> / </span><a class="link-muted" href="/categories/%E7%BC%96%E7%A8%8B/Labs/">Labs</a><span> / </span><a class="link-muted" href="/categories/%E7%BC%96%E7%A8%8B/Labs/CMU-15-213/">CMU 15-213</a></span><span class="level-item">30 分钟读完 (大约4448个字)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">CSAPP Lab2 Defusing a Binary Bomb</h1><div class="content"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>由于实验需要在 x86-64 环境下使用，因此我不得不放弃使用 m1 芯片的 mac 转而使用 win10 在虚拟机上跑了个 centos，这里用 vmware 安装好后，再在 centos 上安装 GDB 即可。</p>
<span id="more"></span>
<p>实验前务必参考 <a target="_blank" rel="noopener" href="http://csapp.cs.cmu.edu/3e/bomblab.pdf">讲义</a>。</p>
<h2 id="准备工作">准备工作</h2>
<p>首先，使用 objdump 反编译 bomb，方便后面拆炸弹。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@MiWiFi-R4A-srv bomb]# objdump -d bomb &gt; bomb.txt</span><br></pre></td></tr></table></figure>
<p>然后常用 GDB 命令查询了解即可，<a target="_blank" rel="noopener" href="https://www.cnblogs.com/me115/p/3837960.html">GDB 常用命令 - 大 CC - 博客园 (cnblogs.com)</a> 。最后是 x86-64 架构的寄存器含义，可以参考 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/wsg1100/p/14290340.html#%E4%BA%94%E5%B8%B8%E8%A7%81%E6%B1%87%E7%BC%96%E7%BB%93%E6%9E%84">【原创】X86_64/X86 GNU 汇编、寄存器、内嵌汇编 - 沐多 - 博客园 (cnblogs.com)</a>，建议反复看。另外，如果想从 gdb 运行中途出来打印，又不想没头苍蝇一样打断点，可以直接俄 ctrl+c 出来，然后 continue 继续。</p>
<h2 id="Phase1">Phase1</h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Hmm...  Six phases must be more secure than one phase! */</span></span><br><span class="line">    input = read_line();             <span class="comment">/* Get input                   */</span></span><br><span class="line">    phase_1(input);                  <span class="comment">/* Run the phase               */</span></span><br><span class="line">    phase_defused();                 <span class="comment">/* Drat!  They figured it out!</span></span><br><span class="line"><span class="comment">    /* Let me know how they did it. */</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Phase 1 defused. How about the next one?\n&quot;</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0000000000400ee0 &lt;phase_1&gt;:</span><br><span class="line">  400ee0: <span class="number">48</span> <span class="number">83</span> ec <span class="number">08</span>           <span class="keyword">sub</span>    <span class="number">$0</span>x8,%rsp</span><br><span class="line">  400ee4: be <span class="number">00</span> <span class="number">24</span> <span class="number">40</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x402400,%esi</span><br><span class="line">  400ee9: e8 4a <span class="number">04</span> <span class="number">00</span> <span class="number">00</span>        callq  <span class="number">401338</span> &lt;strings_not_equal&gt;</span><br><span class="line">  400eee: <span class="number">85</span> c0                 <span class="keyword">test</span>   %eax,%eax</span><br><span class="line">  400ef0: <span class="number">74</span> <span class="number">05</span>                 <span class="keyword">je</span>     400ef7 &lt;phase_1+<span class="number">0x17</span>&gt;</span><br><span class="line">  400ef2: e8 <span class="number">43</span> <span class="number">05</span> <span class="number">00</span> <span class="number">00</span>        callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  400ef7: <span class="number">48</span> <span class="number">83</span> c4 <span class="number">08</span>           <span class="keyword">add</span>    <span class="number">$0</span>x8,%rsp</span><br><span class="line">  400efb: c3                    retq</span><br></pre></td></tr></table></figure>
<p>从 c 代码中不难发现，我们输入一行字符串作为参数，进入 phase1 进行解析。在反汇编得到的文件中找到 phase1 相关部分，挨个解析，再次提示可以反复查阅 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/wsg1100/p/14290340.html#%E4%BA%94%E5%B8%B8%E8%A7%81%E6%B1%87%E7%BC%96%E7%BB%93%E6%9E%84">【原创】X86_64/X86 GNU 汇编、寄存器、内嵌汇编 - 沐多 - 博客园 (cnblogs.com)</a>。</p>
<p>首先，esi 寄存器保存了 0x402400，按照经验这应该是一个地址，然后调用了函数 strings_not_equal，其功能不难猜出是比较两个字符串是否相等。注意，esi 常用来保存第二个参数，而 edi 常用保存第一个参数，由于在进入 strings_not_equal 之前并没有对其修改，所以其接受的第一个参数默认是父函数也就是 phase_1 接受的第一个（也是唯一一个）参数，即我们所输入的字符串。当我们得到结果后，会经过一段由 test 和 je 组合的检测代码，如果 eax 等于 0 则跳转，越过 explode_bomb。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0000000000401338</span> &lt;strings_not_equal&gt;:</span><br><span class="line">  <span class="number">401338</span>: <span class="number">41</span> <span class="number">54</span>                 <span class="keyword">push</span>   %r12</span><br><span class="line">  40133a: <span class="number">55</span>                    <span class="keyword">push</span>   %rbp</span><br><span class="line">  40133b: <span class="number">53</span>                    <span class="keyword">push</span>   %rbx</span><br><span class="line">  40133c: <span class="number">48</span> <span class="number">89</span> fb              <span class="keyword">mov</span>    %rdi,%rbx // 字符串 input</span><br><span class="line">  40133f: <span class="number">48</span> <span class="number">89</span> f5              <span class="keyword">mov</span>    %rsi,%rbp // 字符串<span class="string">&quot;???&quot;</span></span><br><span class="line">  <span class="number">401342</span>: e8 d4 ff ff ff        callq  40131b &lt;string_length&gt;</span><br><span class="line">  <span class="number">401347</span>: <span class="number">41</span> <span class="number">89</span> c4              <span class="keyword">mov</span>    %eax,%r12d</span><br><span class="line">  40134a: <span class="number">48</span> <span class="number">89</span> ef              <span class="keyword">mov</span>    %rbp,%rdi</span><br><span class="line">  <span class="number">40134d</span>: e8 c9 ff ff ff        callq  40131b &lt;string_length&gt;</span><br><span class="line">  <span class="number">401352</span>: ba <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x1,%edx</span><br><span class="line">  <span class="number">401357</span>: <span class="number">41</span> <span class="number">39</span> c4              <span class="keyword">cmp</span>    %eax,%r12d</span><br><span class="line">  40135a: <span class="number">75</span> 3f                 <span class="keyword">jne</span>    40139b &lt;strings_not_equal+<span class="number">0x63</span>&gt;</span><br><span class="line">  40135c: 0f b6 <span class="number">03</span>              movzbl (%rbx),%eax</span><br><span class="line">  40135f: <span class="number">84</span> c0                 <span class="keyword">test</span>   %al,%al // 长度为 <span class="number">0</span> jump</span><br><span class="line">  <span class="number">401361</span>: <span class="number">74</span> <span class="number">25</span>                 <span class="keyword">je</span>     <span class="number">401388</span> &lt;strings_not_equal+<span class="number">0x50</span>&gt;</span><br><span class="line">  <span class="number">401363</span>: 3a <span class="number">45</span> <span class="number">00</span>              <span class="keyword">cmp</span>    <span class="number">0x0</span>(%rbp),%al</span><br><span class="line">  <span class="number">401366</span>: <span class="number">74</span> 0a                 <span class="keyword">je</span>     <span class="number">401372</span> &lt;strings_not_equal+<span class="number">0x3a</span>&gt;</span><br><span class="line">  <span class="number">401368</span>: eb <span class="number">25</span>                 <span class="keyword">jmp</span>    40138f &lt;strings_not_equal+<span class="number">0x57</span>&gt;</span><br><span class="line">  40136a: 3a <span class="number">45</span> <span class="number">00</span>              <span class="keyword">cmp</span>    <span class="number">0x0</span>(%rbp),%al</span><br><span class="line">  <span class="number">40136d</span>: 0f 1f <span class="number">00</span>              nopl   (%rax)</span><br><span class="line">  <span class="number">401370</span>: <span class="number">75</span> <span class="number">24</span>                 <span class="keyword">jne</span>    <span class="number">401396</span> &lt;strings_not_equal+<span class="number">0x5e</span>&gt;</span><br><span class="line">  <span class="number">401372</span>: <span class="number">48</span> <span class="number">83</span> c3 <span class="number">01</span>           <span class="keyword">add</span>    <span class="number">$0</span>x1,%rbx</span><br><span class="line">  <span class="number">401376</span>: <span class="number">48</span> <span class="number">83</span> c5 <span class="number">01</span>           <span class="keyword">add</span>    <span class="number">$0</span>x1,%rbp</span><br><span class="line">  40137a: 0f b6 <span class="number">03</span>              movzbl (%rbx),%eax</span><br><span class="line">  <span class="number">40137d</span>: <span class="number">84</span> c0                 <span class="keyword">test</span>   %al,%al</span><br><span class="line">  40137f: <span class="number">75</span> e9                 <span class="keyword">jne</span>    40136a &lt;strings_not_equal+<span class="number">0x32</span>&gt;</span><br><span class="line">  <span class="number">401381</span>: ba <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x0,%edx</span><br><span class="line">  <span class="number">401386</span>: eb <span class="number">13</span>                 <span class="keyword">jmp</span>    40139b &lt;strings_not_equal+<span class="number">0x63</span>&gt;</span><br><span class="line">  <span class="number">401388</span>: ba <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x0,%edx</span><br><span class="line">  <span class="number">40138d</span>: eb 0c                 <span class="keyword">jmp</span>    40139b &lt;strings_not_equal+<span class="number">0x63</span>&gt;</span><br><span class="line">  40138f: ba <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x1,%edx</span><br><span class="line">  <span class="number">401394</span>: eb <span class="number">05</span>                 <span class="keyword">jmp</span>    40139b &lt;strings_not_equal+<span class="number">0x63</span>&gt;</span><br><span class="line">  <span class="number">401396</span>: ba <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x1,%edx</span><br><span class="line">  40139b: <span class="number">89</span> d0                 <span class="keyword">mov</span>    %edx,%eax</span><br><span class="line">  <span class="number">40139d</span>: 5b                    <span class="keyword">pop</span>    %rbx</span><br><span class="line">  40139e: <span class="number">5d</span>                    <span class="keyword">pop</span>    %rbp</span><br><span class="line">  40139f: <span class="number">41</span> 5c                 <span class="keyword">pop</span>    %r12</span><br><span class="line">  4013a1: c3                    retq</span><br></pre></td></tr></table></figure>
<p>然后，进入 strings_not_equal 具体分析，string_length 内部就是不断累加长度直到遇到’\0’。如果字符串 a 和 b 长度不相等就返回 1，长度相等且长度为 0 则返回 0，然后一个字符一个字符比较。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">print</span> (char *)0x402400</span><br><span class="line"><span class="variable">$1</span> = 0x402400 <span class="string">&quot;Border relations with Canada have never been better.&quot;</span></span><br></pre></td></tr></table></figure>
<p>现在，我们知道 0x402400 确实是一个字符串起始地址，直接通过 GDB 找到并输入即可。</p>
<h2 id="Phase2">Phase2</h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* The second phase is harder.  No one will ever figure out</span></span><br><span class="line"><span class="comment">     * how to defuse this... */</span></span><br><span class="line">    input = read_line();</span><br><span class="line">    phase_2(input);</span><br><span class="line">    phase_defused();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;That&#x27;s number 2.  Keep going!\n&quot;</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">0000000000400efc &lt;phase_2&gt;:</span><br><span class="line">  400efc: <span class="number">55</span>                    <span class="keyword">push</span>   %rbp</span><br><span class="line">  400efd: <span class="number">53</span>                    <span class="keyword">push</span>   %rbx</span><br><span class="line">  400efe: <span class="number">48</span> <span class="number">83</span> ec <span class="number">28</span>           <span class="keyword">sub</span>    <span class="number">$0</span>x28,%rsp</span><br><span class="line">  400f02: <span class="number">48</span> <span class="number">89</span> e6              <span class="keyword">mov</span>    %rsp,%rsi</span><br><span class="line">  400f05: e8 <span class="number">52</span> <span class="number">05</span> <span class="number">00</span> <span class="number">00</span>        callq  40145c &lt;read_six_numbers&gt;</span><br><span class="line">  400f0a: <span class="number">83</span> 3c <span class="number">24</span> <span class="number">01</span>           cmpl   <span class="number">$0</span>x1,(%rsp)</span><br><span class="line">  400f0e: <span class="number">74</span> <span class="number">20</span>                 <span class="keyword">je</span>     400f30 &lt;phase_2+<span class="number">0x34</span>&gt;</span><br><span class="line">  400f10: e8 <span class="number">25</span> <span class="number">05</span> <span class="number">00</span> <span class="number">00</span>        callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  400f15: eb <span class="number">19</span>                 <span class="keyword">jmp</span>    400f30 &lt;phase_2+<span class="number">0x34</span>&gt;</span><br><span class="line">  400f17: 8b <span class="number">43</span> fc              <span class="keyword">mov</span>    -<span class="number">0x4</span>(%rbx),%eax</span><br><span class="line">  400f1a: <span class="number">01</span> c0                 <span class="keyword">add</span>    %eax,%eax</span><br><span class="line">  400f1c: <span class="number">39</span> <span class="number">03</span>                 <span class="keyword">cmp</span>    %eax,(%rbx)</span><br><span class="line">  400f1e: <span class="number">74</span> <span class="number">05</span>                 <span class="keyword">je</span>     400f25 &lt;phase_2+<span class="number">0x29</span>&gt;</span><br><span class="line">  400f20: e8 <span class="number">15</span> <span class="number">05</span> <span class="number">00</span> <span class="number">00</span>        callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  400f25: <span class="number">48</span> <span class="number">83</span> c3 <span class="number">04</span>           <span class="keyword">add</span>    <span class="number">$0</span>x4,%rbx</span><br><span class="line">  400f29: <span class="number">48</span> <span class="number">39</span> eb              <span class="keyword">cmp</span>    %rbp,%rbx</span><br><span class="line">  400f2c: <span class="number">75</span> e9                 <span class="keyword">jne</span>    400f17 &lt;phase_2+<span class="number">0x1b</span>&gt;</span><br><span class="line">  400f2e: eb 0c                 <span class="keyword">jmp</span>    400f3c &lt;phase_2+<span class="number">0x40</span>&gt;</span><br><span class="line">  400f30: <span class="number">48</span> <span class="number">8d</span> 5c <span class="number">24</span> <span class="number">04</span>        <span class="keyword">lea</span>    <span class="number">0x4</span>(%rsp),%rbx</span><br><span class="line">  400f35: <span class="number">48</span> <span class="number">8d</span> 6c <span class="number">24</span> <span class="number">18</span>        <span class="keyword">lea</span>    <span class="number">0x18</span>(%rsp),%rbp</span><br><span class="line">  400f3a: eb <span class="built_in">db</span>                 <span class="keyword">jmp</span>    400f17 &lt;phase_2+<span class="number">0x1b</span>&gt;</span><br><span class="line">  400f3c: <span class="number">48</span> <span class="number">83</span> c4 <span class="number">28</span>           <span class="keyword">add</span>    <span class="number">$0</span>x28,%rsp</span><br><span class="line">  400f40: 5b                    <span class="keyword">pop</span>    %rbx</span><br><span class="line">  400f41: <span class="number">5d</span>                    <span class="keyword">pop</span>    %rbp</span><br><span class="line">  400f42: c3                    retq</span><br></pre></td></tr></table></figure>
<p>进入其汇编码后，发现有个函数 read_six_numbers，顾名思义读 6 个数字。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">000000000040145c &lt;read_six_numbers&gt;:</span><br><span class="line">  40145c: <span class="number">48</span> <span class="number">83</span> ec <span class="number">18</span>           <span class="keyword">sub</span>    <span class="number">$0</span>x18,%rsp</span><br><span class="line">  <span class="number">401460</span>: <span class="number">48</span> <span class="number">89</span> f2              <span class="keyword">mov</span>    %rsi,%rdx // <span class="number">0</span>-&gt;参数 <span class="number">3</span></span><br><span class="line">  <span class="number">401463</span>: <span class="number">48</span> <span class="number">8d</span> 4e <span class="number">04</span>           <span class="keyword">lea</span>    <span class="number">0x4</span>(%rsi),%rcx // <span class="number">4</span>-&gt;参数 <span class="number">4</span></span><br><span class="line">  <span class="number">401467</span>: <span class="number">48</span> <span class="number">8d</span> <span class="number">46</span> <span class="number">14</span>           <span class="keyword">lea</span>    <span class="number">0x14</span>(%rsi),%rax </span><br><span class="line">  40146b: <span class="number">48</span> <span class="number">89</span> <span class="number">44</span> <span class="number">24</span> <span class="number">08</span>        <span class="keyword">mov</span>    %rax,<span class="number">0x8</span>(%rsp) // <span class="number">20</span>-&gt;参数 <span class="number">8</span></span><br><span class="line">  <span class="number">401470</span>: <span class="number">48</span> <span class="number">8d</span> <span class="number">46</span> <span class="number">10</span>           <span class="keyword">lea</span>    <span class="number">0x10</span>(%rsi),%rax</span><br><span class="line">  <span class="number">401474</span>: <span class="number">48</span> <span class="number">89</span> <span class="number">04</span> <span class="number">24</span>           <span class="keyword">mov</span>    %rax,(%rsp) // <span class="number">16</span>-&gt;参数 <span class="number">7</span></span><br><span class="line">  <span class="number">401478</span>: 4c <span class="number">8d</span> 4e 0c           <span class="keyword">lea</span>    <span class="number">0xc</span>(%rsi),%r9 // <span class="number">12</span>-&gt;参数 <span class="number">6</span></span><br><span class="line">  40147c: 4c <span class="number">8d</span> <span class="number">46</span> <span class="number">08</span>           <span class="keyword">lea</span>    <span class="number">0x8</span>(%rsi),%r8 // <span class="number">8</span>-&gt;参数 <span class="number">5</span></span><br><span class="line">  <span class="number">401480</span>: be c3 <span class="number">25</span> <span class="number">40</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x4025c3,%esi</span><br><span class="line">  <span class="number">401485</span>: b8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x0,%eax</span><br><span class="line">  40148a: e8 <span class="number">61</span> f7 ff ff        callq  400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">  40148f: <span class="number">83</span> f8 <span class="number">05</span>              <span class="keyword">cmp</span>    <span class="number">$0</span>x5,%eax</span><br><span class="line">  <span class="number">401492</span>: 7f <span class="number">05</span>                 <span class="keyword">jg</span>     <span class="number">401499</span> &lt;read_six_numbers+<span class="number">0x3d</span>&gt;</span><br><span class="line">  <span class="number">401494</span>: e8 a1 ff ff ff        callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  <span class="number">401499</span>: <span class="number">48</span> <span class="number">83</span> c4 <span class="number">18</span>           <span class="keyword">add</span>    <span class="number">$0</span>x18,%rsp</span><br><span class="line">  <span class="number">40149d</span>: c3                    retq</span><br></pre></td></tr></table></figure>
<p>实际上其汇编码有点乱，但经过注释，不难发现其实它就是将连续六个数字的位置映射到__isoc99_sscanf@plt 函数的参数 3~8 中，第一个参数 rdi 虽然没写，但我们知道其实就是 input，而第二个参数 esi=0x4025c3 是这个读写函数的格式，我们用 gdb 直接调试可以查到：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">print</span> (char*)0x4025c3</span><br><span class="line"><span class="variable">$3</span> = 0x4025c3 <span class="string">&quot;%d %d %d %d %d %d&quot;</span></span><br></pre></td></tr></table></figure>
<p>而且，由于第一个数字（我注释 0→参数 3 那行）映射的 rsi 在父函数 phase2 中其实是 rsp，这下我们终于明白出函数 read_six_numbers 后，首先做的是将第一个数和 1 比较，相等则跳过炸弹。然后是一个循环函数，每次让前一个数的两倍和当前数比较，翻译过就是 <code>a[i + 1] = a[i] * 2</code>，直到 6 个数都遍历完。</p>
<p>最后，我们输入以 1 开始的一个等比数列即可 “1 2 4 8 16 32”，当然由于跳转语句最后用的 jg，我们后面还可以添加数字。另外，<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/22489434/how-does-call-isoc99-sscanf-work">函数__isoc99_sscanf@plt 的返回值是其解析匹配成功的数字个数</a>。</p>
<h2 id="Phase3">Phase3</h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* I guess this is too easy so far.  Some more complex code will</span></span><br><span class="line"><span class="comment">     * confuse people. */</span></span><br><span class="line">    input = read_line();</span><br><span class="line">    phase_3(input);</span><br><span class="line">    phase_defused();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Halfway there!\n&quot;</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">0000000000400f43 &lt;phase_3&gt;:</span><br><span class="line">  400f43: <span class="number">48</span> <span class="number">83</span> ec <span class="number">18</span>           <span class="keyword">sub</span>    <span class="number">$0</span>x18,%rsp</span><br><span class="line">  400f47: <span class="number">48</span> <span class="number">8d</span> 4c <span class="number">24</span> 0c        <span class="keyword">lea</span>    <span class="number">0xc</span>(%rsp),%rcx // 参数 <span class="number">4</span></span><br><span class="line">  400f4c: <span class="number">48</span> <span class="number">8d</span> <span class="number">54</span> <span class="number">24</span> <span class="number">08</span>        <span class="keyword">lea</span>    <span class="number">0x8</span>(%rsp),%rdx // 参数 <span class="number">3</span></span><br><span class="line">  400f51: be cf <span class="number">25</span> <span class="number">40</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x4025cf,%esi</span><br><span class="line">  400f56: b8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x0,%eax</span><br><span class="line">  400f5b: e8 <span class="number">90</span> fc ff ff        callq  400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">  400f60: <span class="number">83</span> f8 <span class="number">01</span>              <span class="keyword">cmp</span>    <span class="number">$0</span>x1,%eax</span><br><span class="line">  400f63: 7f <span class="number">05</span>                 <span class="keyword">jg</span>     400f6a &lt;phase_3+<span class="number">0x27</span>&gt; // jump greater</span><br><span class="line">  400f65: e8 d0 <span class="number">04</span> <span class="number">00</span> <span class="number">00</span>        callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  400f6a: <span class="number">83</span> 7c <span class="number">24</span> <span class="number">08</span> <span class="number">07</span>        cmpl   <span class="number">$0</span>x7,<span class="number">0x8</span>(%rsp)</span><br><span class="line">  400f6f: <span class="number">77</span> 3c                 <span class="keyword">ja</span>     400fad &lt;phase_3+<span class="number">0x6a</span>&gt; // jump above</span><br><span class="line">  400f71: 8b <span class="number">44</span> <span class="number">24</span> <span class="number">08</span>           <span class="keyword">mov</span>    <span class="number">0x8</span>(%rsp),%eax</span><br><span class="line">  400f75: ff <span class="number">24</span> c5 <span class="number">70</span> <span class="number">24</span> <span class="number">40</span> <span class="number">00</span>  jmpq   *<span class="number">0x402470</span>(,%rax,<span class="number">8</span>)</span><br><span class="line">  400f7c: b8 cf <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>xcf,%eax // <span class="number">0</span>-&gt;<span class="number">0xcf</span>=<span class="number">207</span></span><br><span class="line">  400f81: eb 3b                 <span class="keyword">jmp</span>    400fbe &lt;phase_3+<span class="number">0x7b</span>&gt;</span><br><span class="line">  400f83: b8 c3 <span class="number">02</span> <span class="number">00</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x2c3,%eax // <span class="number">2</span></span><br><span class="line">  400f88: eb <span class="number">34</span>                 <span class="keyword">jmp</span>    400fbe &lt;phase_3+<span class="number">0x7b</span>&gt;</span><br><span class="line">  400f8a: b8 <span class="number">00</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x100,%eax // <span class="number">3</span></span><br><span class="line">  400f8f: eb <span class="number">2d</span>                 <span class="keyword">jmp</span>    400fbe &lt;phase_3+<span class="number">0x7b</span>&gt;</span><br><span class="line">  400f91: b8 <span class="number">85</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x185,%eax // <span class="number">4</span></span><br><span class="line">  400f96: eb <span class="number">26</span>                 <span class="keyword">jmp</span>    400fbe &lt;phase_3+<span class="number">0x7b</span>&gt;</span><br><span class="line">  400f98: b8 ce <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>xce,%eax // <span class="number">5</span></span><br><span class="line">  400f9d: eb 1f                 <span class="keyword">jmp</span>    400fbe &lt;phase_3+<span class="number">0x7b</span>&gt;</span><br><span class="line">  400f9f: b8 aa <span class="number">02</span> <span class="number">00</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x2aa,%eax // <span class="number">6</span></span><br><span class="line">  400fa4: eb <span class="number">18</span>                 <span class="keyword">jmp</span>    400fbe &lt;phase_3+<span class="number">0x7b</span>&gt;</span><br><span class="line">  400fa6: b8 <span class="number">47</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x147,%eax // <span class="number">7</span></span><br><span class="line">  400fab: eb <span class="number">11</span>                 <span class="keyword">jmp</span>    400fbe &lt;phase_3+<span class="number">0x7b</span>&gt;</span><br><span class="line">  400fad: e8 <span class="number">88</span> <span class="number">04</span> <span class="number">00</span> <span class="number">00</span>        callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  400fb2: b8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x0,%eax</span><br><span class="line">  400fb7: eb <span class="number">05</span>                 <span class="keyword">jmp</span>    400fbe &lt;phase_3+<span class="number">0x7b</span>&gt;</span><br><span class="line">  400fb9: b8 <span class="number">37</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x137,%eax // <span class="number">1</span></span><br><span class="line">  400fbe: 3b <span class="number">44</span> <span class="number">24</span> 0c           <span class="keyword">cmp</span>    <span class="number">0xc</span>(%rsp),%eax</span><br><span class="line">  400fc2: <span class="number">74</span> <span class="number">05</span>                 <span class="keyword">je</span>     400fc9 &lt;phase_3+<span class="number">0x86</span>&gt;</span><br><span class="line">  400fc4: e8 <span class="number">71</span> <span class="number">04</span> <span class="number">00</span> <span class="number">00</span>        callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  400fc9: <span class="number">48</span> <span class="number">83</span> c4 <span class="number">18</span>           <span class="keyword">add</span>    <span class="number">$0</span>x18,%rsp</span><br><span class="line">  400fcd: c3                    retq</span><br></pre></td></tr></table></figure>
<p>在 phase3 起始位置我们看到了和 read_six_numbers 似曾相识的代码，不同的是这次读写格式地址变成了 0x4025cf，我们使用 gdb 解析，得到</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">print</span> (char*)0x4025cf</span><br><span class="line"><span class="variable">$4</span> = 0x4025cf <span class="string">&quot;%d %d&quot;</span></span><br></pre></td></tr></table></figure>
<p>这次只需要解析两个数字，它们分别放在 0x8 (%rsp) 和 0xc (%rsp)，理所当然的检查了一下解析数字数目，大于一个才能不爆炸。然后是 ja，让第一个数（我们假设为 a）不能大于 7。然后是一个跳转指令，要跳到 0x402470+8xa 这个地址。由于 8bit 为两个字节，所以我们在查看从 0~7 对应的 8 组地址时需要 16 个字节，当然也可以更多就是了，不过我们只需要 16 个字节，注意用 16 进制表示。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/16x 0x402470</span><br><span class="line">0x402470: 0x00400f7c 0x00000000 0x00400fb9 0x00000000</span><br><span class="line">0x402480: 0x00400f83 0x00000000 0x00400f8a 0x00000000</span><br><span class="line">0x402490: 0x00400f91 0x00000000 0x00400f98 0x00000000</span><br><span class="line">0x4024a0: 0x00400f9f 0x00000000 0x00400fa6 0x00000000</span><br></pre></td></tr></table></figure>
<p>结合这八个地址和机器码不难发现，这就是一个分支选择，写入下标和其对应数字即可，比如 “0 207”。</p>
<h2 id="Phase4">Phase4</h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Oh yeah?  Well, how good is your math?  Try on this saucy problem! */</span></span><br><span class="line">    input = read_line();</span><br><span class="line">    phase_4(input);</span><br><span class="line">    phase_defused();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;So you got that one.  Try this one.\n&quot;</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">000000000040100c &lt;phase_4&gt;:</span><br><span class="line">  40100c: <span class="number">48</span> <span class="number">83</span> ec <span class="number">18</span>           <span class="keyword">sub</span>    <span class="number">$0</span>x18,%rsp</span><br><span class="line">  <span class="number">401010</span>: <span class="number">48</span> <span class="number">8d</span> 4c <span class="number">24</span> 0c        <span class="keyword">lea</span>    <span class="number">0xc</span>(%rsp),%rcx</span><br><span class="line">  <span class="number">401015</span>: <span class="number">48</span> <span class="number">8d</span> <span class="number">54</span> <span class="number">24</span> <span class="number">08</span>        <span class="keyword">lea</span>    <span class="number">0x8</span>(%rsp),%rdx</span><br><span class="line">  40101a: be cf <span class="number">25</span> <span class="number">40</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x4025cf,%esi</span><br><span class="line">  40101f: b8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x0,%eax</span><br><span class="line">  <span class="number">401024</span>: e8 c7 fb ff ff        callq  400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">  <span class="number">401029</span>: <span class="number">83</span> f8 <span class="number">02</span>              <span class="keyword">cmp</span>    <span class="number">$0</span>x2,%eax</span><br><span class="line">  40102c: <span class="number">75</span> <span class="number">07</span>                 <span class="keyword">jne</span>    <span class="number">401035</span> &lt;phase_4+<span class="number">0x29</span>&gt;</span><br><span class="line">  40102e: <span class="number">83</span> 7c <span class="number">24</span> <span class="number">08</span> 0e        cmpl   <span class="number">$0</span>xe,<span class="number">0x8</span>(%rsp)</span><br><span class="line">  <span class="number">401033</span>: <span class="number">76</span> <span class="number">05</span>                 <span class="keyword">jbe</span>    40103a &lt;phase_4+<span class="number">0x2e</span>&gt; // below &amp; equal</span><br><span class="line">  <span class="number">401035</span>: e8 <span class="number">00</span> <span class="number">04</span> <span class="number">00</span> <span class="number">00</span>        callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  40103a: ba 0e <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>xe,%edx</span><br><span class="line">  40103f: be <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x0,%esi</span><br><span class="line">  <span class="number">401044</span>: 8b 7c <span class="number">24</span> <span class="number">08</span>           <span class="keyword">mov</span>    <span class="number">0x8</span>(%rsp),%edi</span><br><span class="line">  <span class="number">401048</span>: e8 <span class="number">81</span> ff ff ff        callq  400fce &lt;func4&gt;</span><br><span class="line">  <span class="number">40104d</span>: <span class="number">85</span> c0                 <span class="keyword">test</span>   %eax,%eax</span><br><span class="line">  40104f: <span class="number">75</span> <span class="number">07</span>                 <span class="keyword">jne</span>    <span class="number">401058</span> &lt;phase_4+<span class="number">0x4c</span>&gt;</span><br><span class="line">  <span class="number">401051</span>: <span class="number">83</span> 7c <span class="number">24</span> 0c <span class="number">00</span>        cmpl   <span class="number">$0</span>x0,<span class="number">0xc</span>(%rsp)</span><br><span class="line">  <span class="number">401056</span>: <span class="number">74</span> <span class="number">05</span>                 <span class="keyword">je</span>     <span class="number">40105d</span> &lt;phase_4+<span class="number">0x51</span>&gt;</span><br><span class="line">  <span class="number">401058</span>: e8 <span class="built_in">dd</span> <span class="number">03</span> <span class="number">00</span> <span class="number">00</span>        callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  <span class="number">40105d</span>: <span class="number">48</span> <span class="number">83</span> c4 <span class="number">18</span>           <span class="keyword">add</span>    <span class="number">$0</span>x18,%rsp</span><br><span class="line">  <span class="number">401061</span>: c3                    retq</span><br></pre></td></tr></table></figure>
<p>phase4 依然是读入两个数字，jbe 就是 jump+below+equal 的组合，其含义不言自明，第一个数要小于等于 14。然后预设了两个参数 14 和 0，和输入的第一个数一起传入 func4。后面紧跟 test 和 jne，要求 func4 结果必须为 0，后面的 cmpl 和 je 要求第二个数必须为 0。一切都很明朗，我们需要输入一个 x 和一个 0。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">0000000000400fce &lt;func4&gt;:</span><br><span class="line">  400fce: <span class="number">48</span> <span class="number">83</span> ec <span class="number">08</span>           <span class="keyword">sub</span>    <span class="number">$0</span>x8,%rsp</span><br><span class="line">  400fd2: <span class="number">89</span> d0                 <span class="keyword">mov</span>    %edx,%eax </span><br><span class="line">  400fd4: <span class="number">29</span> f0                 <span class="keyword">sub</span>    %esi,%eax  </span><br><span class="line">  400fd6: <span class="number">89</span> c1                 <span class="keyword">mov</span>    %eax,%ecx</span><br><span class="line">  400fd8: c1 e9 1f              <span class="keyword">shr</span>    <span class="number">$0</span>x1f,%ecx // shift+right</span><br><span class="line">  400fdb: <span class="number">01</span> c8                 <span class="keyword">add</span>    %ecx,%eax</span><br><span class="line">  400fdd: d1 f8                 <span class="keyword">sar</span>    %eax</span><br><span class="line">  400fdf: <span class="number">8d</span> 0c <span class="number">30</span>              <span class="keyword">lea</span>    (%rax,%rsi,<span class="number">1</span>),%ecx // (r - l) / <span class="number">2</span> + l</span><br><span class="line">  400fe2: <span class="number">39</span> f9                 <span class="keyword">cmp</span>    %edi,%ecx</span><br><span class="line">  400fe4: 7e 0c                 <span class="keyword">jle</span>    400ff2 &lt;func4+<span class="number">0x24</span>&gt;</span><br><span class="line">  400fe6: <span class="number">8d</span> <span class="number">51</span> ff              <span class="keyword">lea</span>    -<span class="number">0x1</span>(%rcx),%edx // r = mid - <span class="number">1</span></span><br><span class="line">  400fe9: e8 e0 ff ff ff        callq  400fce &lt;func4&gt;</span><br><span class="line">  400fee: <span class="number">01</span> c0                 <span class="keyword">add</span>    %eax,%eax</span><br><span class="line">  400ff0: eb <span class="number">15</span>                 <span class="keyword">jmp</span>    <span class="number">401007</span> &lt;func4+<span class="number">0x39</span>&gt;</span><br><span class="line">  400ff2: b8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x0,%eax</span><br><span class="line">  400ff7: <span class="number">39</span> f9                 <span class="keyword">cmp</span>    %edi,%ecx</span><br><span class="line">  400ff9: <span class="number">7d</span> 0c                 <span class="keyword">jge</span>    <span class="number">401007</span> &lt;func4+<span class="number">0x39</span>&gt;</span><br><span class="line">  400ffb: <span class="number">8d</span> <span class="number">71</span> <span class="number">01</span>              <span class="keyword">lea</span>    <span class="number">0x1</span>(%rcx),%esi // l = mid + <span class="number">1</span></span><br><span class="line">  400ffe: e8 cb ff ff ff        callq  400fce &lt;func4&gt;</span><br><span class="line">  <span class="number">401003</span>: <span class="number">8d</span> <span class="number">44</span> <span class="number">00</span> <span class="number">01</span>           <span class="keyword">lea</span>    <span class="number">0x1</span>(%rax,%rax,<span class="number">1</span>),%eax</span><br><span class="line">  <span class="number">401007</span>: <span class="number">48</span> <span class="number">83</span> c4 <span class="number">08</span>           <span class="keyword">add</span>    <span class="number">$0</span>x8,%rsp</span><br><span class="line">  40100b: c3                    retq</span><br></pre></td></tr></table></figure>
<p>由于 func4 有递归，所以我们可以假设输入的是 x，l，r，然后是 (r-l)/2+l。这里有一些细节，shr 逻辑右移时用 0 填充，lea 等效于 mov 的源操作数从地址变成了内容（lea (A) B == mov A B）。以及通过逻辑右移获得 l 和 r 两个变量差值的符号位，这里需要解释一下，由于 ecx 是 32 位形式，所以逻辑右移 31 位得到符号位，这个操作本质是让 r 大于等于 l。然后，我们不难发现，eax 会在从高半区返回后乘以 2 加 1（401003），而从低半区返回后仅仅乘以 2。</p>
<p>综上，我们了解到，首先需要 r 大于等于 l，然后每次都从低半区出来，由于判断语句是 jle，所以等于情况也算作低半区。又因为之前分析过，x 需要小于等于 14，所以只有 0，1，3，7 这四个数字符合，填入即可。</p>
<h2 id="Phase5">Phase5</h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Round and &#x27;round in memory we go, where we stop, the bomb blows! */</span></span><br><span class="line">    input = read_line();</span><br><span class="line">    phase_5(input);</span><br><span class="line">    phase_defused();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Good work!  On to the next...\n&quot;</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0000000000401062</span> &lt;phase_5&gt;:</span><br><span class="line">  <span class="number">401062</span>: <span class="number">53</span>                    <span class="keyword">push</span>   %rbx</span><br><span class="line">  <span class="number">401063</span>: <span class="number">48</span> <span class="number">83</span> ec <span class="number">20</span>           <span class="keyword">sub</span>    <span class="number">$0</span>x20,%rsp</span><br><span class="line">  <span class="number">401067</span>: <span class="number">48</span> <span class="number">89</span> fb              <span class="keyword">mov</span>    %rdi,%rbx</span><br><span class="line">  40106a: <span class="number">64</span> <span class="number">48</span> 8b <span class="number">04</span> <span class="number">25</span> <span class="number">28</span> <span class="number">00</span>  <span class="keyword">mov</span>    %fs:<span class="number">0x28</span>,%rax</span><br><span class="line">  <span class="number">401071</span>: <span class="number">00</span> <span class="number">00</span> </span><br><span class="line">  <span class="number">401073</span>: <span class="number">48</span> <span class="number">89</span> <span class="number">44</span> <span class="number">24</span> <span class="number">18</span>        <span class="keyword">mov</span>    %rax,<span class="number">0x18</span>(%rsp)</span><br><span class="line">  <span class="number">401078</span>: <span class="number">31</span> c0                 <span class="keyword">xor</span>    %eax,%eax</span><br><span class="line">  40107a: e8 9c <span class="number">02</span> <span class="number">00</span> <span class="number">00</span>        callq  40131b &lt;string_length&gt;</span><br><span class="line">  40107f: <span class="number">83</span> f8 <span class="number">06</span>              <span class="keyword">cmp</span>    <span class="number">$0</span>x6,%eax</span><br><span class="line">  <span class="number">401082</span>: <span class="number">74</span> 4e                 <span class="keyword">je</span>     4010d2 &lt;phase_5+<span class="number">0x70</span>&gt;</span><br><span class="line">  <span class="number">401084</span>: e8 b1 <span class="number">03</span> <span class="number">00</span> <span class="number">00</span>        callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  <span class="number">401089</span>: eb <span class="number">47</span>                 <span class="keyword">jmp</span>    4010d2 &lt;phase_5+<span class="number">0x70</span>&gt;</span><br><span class="line">  40108b: 0f b6 0c <span class="number">03</span>           movzbl (%rbx,%rax,<span class="number">1</span>),%ecx</span><br><span class="line">  40108f: <span class="number">88</span> 0c <span class="number">24</span>              <span class="keyword">mov</span>    %cl,(%rsp)</span><br><span class="line">  <span class="number">401092</span>: <span class="number">48</span> 8b <span class="number">14</span> <span class="number">24</span>           <span class="keyword">mov</span>    (%rsp),%rdx</span><br><span class="line">  <span class="number">401096</span>: <span class="number">83</span> e2 0f              <span class="keyword">and</span>    <span class="number">$0</span>xf,%edx</span><br><span class="line">  <span class="number">401099</span>: 0f b6 <span class="number">92</span> b0 <span class="number">24</span> <span class="number">40</span> <span class="number">00</span>  movzbl <span class="number">0x4024b0</span>(%rdx),%edx</span><br><span class="line">  4010a0: <span class="number">88</span> <span class="number">54</span> <span class="number">04</span> <span class="number">10</span>           <span class="keyword">mov</span>    %dl,<span class="number">0x10</span>(%rsp,%rax,<span class="number">1</span>)</span><br><span class="line">  4010a4: <span class="number">48</span> <span class="number">83</span> c0 <span class="number">01</span>           <span class="keyword">add</span>    <span class="number">$0</span>x1,%rax</span><br><span class="line">  4010a8: <span class="number">48</span> <span class="number">83</span> f8 <span class="number">06</span>           <span class="keyword">cmp</span>    <span class="number">$0</span>x6,%rax</span><br><span class="line">  4010ac: <span class="number">75</span> <span class="built_in">dd</span>                 <span class="keyword">jne</span>    40108b &lt;phase_5+<span class="number">0x29</span>&gt;</span><br><span class="line">  4010ae: c6 <span class="number">44</span> <span class="number">24</span> <span class="number">16</span> <span class="number">00</span>        movb   <span class="number">$0</span>x0,<span class="number">0x16</span>(%rsp)</span><br><span class="line">  4010b3: be 5e <span class="number">24</span> <span class="number">40</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x40245e,%esi</span><br><span class="line">  4010b8: <span class="number">48</span> <span class="number">8d</span> 7c <span class="number">24</span> <span class="number">10</span>        <span class="keyword">lea</span>    <span class="number">0x10</span>(%rsp),%rdi</span><br><span class="line">  4010bd: e8 <span class="number">76</span> <span class="number">02</span> <span class="number">00</span> <span class="number">00</span>        callq  <span class="number">401338</span> &lt;strings_not_equal&gt;</span><br><span class="line">  4010c2: <span class="number">85</span> c0                 <span class="keyword">test</span>   %eax,%eax</span><br><span class="line">  4010c4: <span class="number">74</span> <span class="number">13</span>                 <span class="keyword">je</span>     4010d9 &lt;phase_5+<span class="number">0x77</span>&gt;</span><br><span class="line">  4010c6: e8 6f <span class="number">03</span> <span class="number">00</span> <span class="number">00</span>        callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  4010cb: 0f 1f <span class="number">44</span> <span class="number">00</span> <span class="number">00</span>        nopl   <span class="number">0x0</span>(%rax,%rax,<span class="number">1</span>)</span><br><span class="line">  4010d0: eb <span class="number">07</span>                 <span class="keyword">jmp</span>    4010d9 &lt;phase_5+<span class="number">0x77</span>&gt;</span><br><span class="line">  4010d2: b8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x0,%eax</span><br><span class="line">  4010d7: eb b2                 <span class="keyword">jmp</span>    40108b &lt;phase_5+<span class="number">0x29</span>&gt;</span><br><span class="line">  4010d9: <span class="number">48</span> 8b <span class="number">44</span> <span class="number">24</span> <span class="number">18</span>        <span class="keyword">mov</span>    <span class="number">0x18</span>(%rsp),%rax</span><br><span class="line">  4010de: <span class="number">64</span> <span class="number">48</span> <span class="number">33</span> <span class="number">04</span> <span class="number">25</span> <span class="number">28</span> <span class="number">00</span>  <span class="keyword">xor</span>    %fs:<span class="number">0x28</span>,%rax</span><br><span class="line">  4010e5: <span class="number">00</span> <span class="number">00</span> </span><br><span class="line">  4010e7: <span class="number">74</span> <span class="number">05</span>                 <span class="keyword">je</span>     4010ee &lt;phase_5+<span class="number">0x8c</span>&gt;</span><br><span class="line">  4010e9: e8 <span class="number">42</span> fa ff ff        callq  400b30 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">  4010ee: <span class="number">48</span> <span class="number">83</span> c4 <span class="number">20</span>           <span class="keyword">add</span>    <span class="number">$0</span>x20,%rsp</span><br><span class="line">  4010f2: 5b                    <span class="keyword">pop</span>    %rbx</span><br><span class="line">  4010f3: c3                    retq</span><br></pre></td></tr></table></figure>
<p>通过函数 string_length 函数限制输入字符串长度为 6，然后是一段循环，观察代码 (%rbx,%rax,1)，由于 rbx 是起始位置，所以不断增加 rax 即可达到遍历每个字符的效果。由于 cl 是 rcx 的 8 比特形式（相当于 mod255），后面又和 0xf 相与（相当于去后四位为有效数字），然后将结果同地址 0x4024b0 加起来得到一个新的地址，这个地址显然保存着一个数，将这个数存到 edx。而 dl 是 edx 的 8 比特形式，存到 0x10 (%rsp+rax * 1)。综合来看，就是将我们输入的六个字符按照特殊方式挨个转换成新的字符，最后同 0x40245e 处的字符串比较，匹配就不爆炸。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(gdb) print (char*)0x4024b0</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">6 = 0x4024b0 &lt;array&gt; <span class="string">&quot;maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?&quot;</span></span></span><br><span class="line">(gdb) print (char*)0x40245e</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">7 = 0x40245e <span class="string">&quot;flyers&quot;</span></span></span><br></pre></td></tr></table></figure>
<p>这里字典很长，但其实我们只需要前 16 个有效字母，也就是 “maduiersnfotvbyl”，而 “flyers” 映射到字母序列为 “f-9 l-15 y-14 e-5 r-6 s-7”，而恰好 a 的 ASCII 码等于 0110 0001，当然 A 对应 0100 0001，所以大小写其实都是等效的，我们通过目标字符串解析的对应下标，倒推我们的源码为 “ionefg”。</p>
<p>另外，汇编中的 401063、40106a 和 4010d9、4010de 呼应，如果二者不匹配会报错。</p>
<h2 id="Phase6">Phase6</h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* This phase will never be used, since no one will get past the</span></span><br><span class="line"><span class="comment"> * earlier ones.  But just in case, make this one extra hard. */</span></span><br><span class="line">input = read_line();</span><br><span class="line">phase_6(input);</span><br><span class="line">phase_defused();</span><br></pre></td></tr></table></figure>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">00000000004010f4 &lt;phase_6&gt;:</span><br><span class="line">  4010f4: <span class="number">41</span> <span class="number">56</span>                 <span class="keyword">push</span>   %r14</span><br><span class="line">  4010f6: <span class="number">41</span> <span class="number">55</span>                 <span class="keyword">push</span>   %r13</span><br><span class="line">  4010f8: <span class="number">41</span> <span class="number">54</span>                 <span class="keyword">push</span>   %r12</span><br><span class="line">  4010fa: <span class="number">55</span>                    <span class="keyword">push</span>   %rbp</span><br><span class="line">  4010fb: <span class="number">53</span>                    <span class="keyword">push</span>   %rbx</span><br><span class="line">  4010fc: <span class="number">48</span> <span class="number">83</span> ec <span class="number">50</span>           <span class="keyword">sub</span>    <span class="number">$0</span>x50,%rsp</span><br><span class="line">  <span class="number">401100</span>: <span class="number">49</span> <span class="number">89</span> e5              <span class="keyword">mov</span>    %rsp,%r13</span><br><span class="line">  <span class="number">401103</span>: <span class="number">48</span> <span class="number">89</span> e6              <span class="keyword">mov</span>    %rsp,%rsi</span><br><span class="line">  <span class="number">401106</span>: e8 <span class="number">51</span> <span class="number">03</span> <span class="number">00</span> <span class="number">00</span>        callq  40145c &lt;read_six_numbers&gt;</span><br><span class="line">  40110b: <span class="number">49</span> <span class="number">89</span> e6              <span class="keyword">mov</span>    %rsp,%r14</span><br><span class="line">  40110e: <span class="number">41</span> bc <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>     <span class="keyword">mov</span>    <span class="number">$0</span>x0,%r12d</span><br><span class="line">====================================================</span><br><span class="line">  <span class="number">401114</span>: 4c <span class="number">89</span> ed              <span class="keyword">mov</span>    %r13,%rbp</span><br><span class="line">  <span class="number">401117</span>: <span class="number">41</span> 8b <span class="number">45</span> <span class="number">00</span>           <span class="keyword">mov</span>    <span class="number">0x0</span>(%r13),%eax</span><br><span class="line">  40111b: <span class="number">83</span> e8 <span class="number">01</span>              <span class="keyword">sub</span>    <span class="number">$0</span>x1,%eax</span><br><span class="line">  40111e: <span class="number">83</span> f8 <span class="number">05</span>              <span class="keyword">cmp</span>    <span class="number">$0</span>x5,%eax</span><br><span class="line">  <span class="number">401121</span>: <span class="number">76</span> <span class="number">05</span>                 <span class="keyword">jbe</span>    <span class="number">401128</span> &lt;phase_6+<span class="number">0x34</span>&gt;</span><br><span class="line">  <span class="number">401123</span>: e8 <span class="number">12</span> <span class="number">03</span> <span class="number">00</span> <span class="number">00</span>        callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  <span class="number">401128</span>: <span class="number">41</span> <span class="number">83</span> c4 <span class="number">01</span>           <span class="keyword">add</span>    <span class="number">$0</span>x1,%r12d</span><br><span class="line">  40112c: <span class="number">41</span> <span class="number">83</span> fc <span class="number">06</span>           <span class="keyword">cmp</span>    <span class="number">$0</span>x6,%r12d</span><br><span class="line">  <span class="number">401130</span>: <span class="number">74</span> <span class="number">21</span>                 <span class="keyword">je</span>     <span class="number">401153</span> &lt;phase_6+<span class="number">0x5f</span>&gt;</span><br><span class="line">  <span class="number">401132</span>: <span class="number">44</span> <span class="number">89</span> e3              <span class="keyword">mov</span>    %r12d,%ebx</span><br><span class="line">  <span class="number">401135</span>: <span class="number">48</span> <span class="number">63</span> c3              movslq %ebx,%rax</span><br><span class="line">  <span class="number">401138</span>: 8b <span class="number">04</span> <span class="number">84</span>              <span class="keyword">mov</span>    (%rsp,%rax,<span class="number">4</span>),%eax</span><br><span class="line">  40113b: <span class="number">39</span> <span class="number">45</span> <span class="number">00</span>              <span class="keyword">cmp</span>    %eax,<span class="number">0x0</span>(%rbp)</span><br><span class="line">  40113e: <span class="number">75</span> <span class="number">05</span>                 <span class="keyword">jne</span>    <span class="number">401145</span> &lt;phase_6+<span class="number">0x51</span>&gt;</span><br><span class="line">  <span class="number">401140</span>: e8 f5 <span class="number">02</span> <span class="number">00</span> <span class="number">00</span>        callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  <span class="number">401145</span>: <span class="number">83</span> c3 <span class="number">01</span>              <span class="keyword">add</span>    <span class="number">$0</span>x1,%ebx</span><br><span class="line">  <span class="number">401148</span>: <span class="number">83</span> fb <span class="number">05</span>              <span class="keyword">cmp</span>    <span class="number">$0</span>x5,%ebx</span><br><span class="line">  40114b: 7e e8                 <span class="keyword">jle</span>    <span class="number">401135</span> &lt;phase_6+<span class="number">0x41</span>&gt;</span><br><span class="line">  <span class="number">40114d</span>: <span class="number">49</span> <span class="number">83</span> c5 <span class="number">04</span>           <span class="keyword">add</span>    <span class="number">$0</span>x4,%r13</span><br><span class="line">  <span class="number">401151</span>: eb c1                 <span class="keyword">jmp</span>    <span class="number">401114</span> &lt;phase_6+<span class="number">0x20</span>&gt;</span><br><span class="line">====================================================</span><br><span class="line">  <span class="number">401153</span>: <span class="number">48</span> <span class="number">8d</span> <span class="number">74</span> <span class="number">24</span> <span class="number">18</span>        <span class="keyword">lea</span>    <span class="number">0x18</span>(%rsp),%rsi</span><br><span class="line">  <span class="number">401158</span>: 4c <span class="number">89</span> f0              <span class="keyword">mov</span>    %r14,%rax</span><br><span class="line">  40115b: b9 <span class="number">07</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x7,%ecx</span><br><span class="line">  <span class="number">401160</span>: <span class="number">89</span> ca                 <span class="keyword">mov</span>    %ecx,%edx</span><br><span class="line">  <span class="number">401162</span>: 2b <span class="number">10</span>                 <span class="keyword">sub</span>    (%rax),%edx</span><br><span class="line">  <span class="number">401164</span>: <span class="number">89</span> <span class="number">10</span>                 <span class="keyword">mov</span>    %edx,(%rax)</span><br><span class="line">  <span class="number">401166</span>: <span class="number">48</span> <span class="number">83</span> c0 <span class="number">04</span>           <span class="keyword">add</span>    <span class="number">$0</span>x4,%rax</span><br><span class="line">  40116a: <span class="number">48</span> <span class="number">39</span> f0              <span class="keyword">cmp</span>    %rsi,%rax</span><br><span class="line">  <span class="number">40116d</span>: <span class="number">75</span> f1                 <span class="keyword">jne</span>    <span class="number">401160</span> &lt;phase_6+<span class="number">0x6c</span>&gt;</span><br><span class="line">  40116f: be <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x0,%esi</span><br><span class="line">  <span class="number">401174</span>: eb <span class="number">21</span>                 <span class="keyword">jmp</span>    <span class="number">401197</span> &lt;phase_6+<span class="number">0xa3</span>&gt;</span><br><span class="line">  <span class="number">401176</span>: <span class="number">48</span> 8b <span class="number">52</span> <span class="number">08</span>           <span class="keyword">mov</span>    <span class="number">0x8</span>(%rdx),%rdx</span><br><span class="line">  40117a: <span class="number">83</span> c0 <span class="number">01</span>              <span class="keyword">add</span>    <span class="number">$0</span>x1,%eax</span><br><span class="line">  <span class="number">40117d</span>: <span class="number">39</span> c8                 <span class="keyword">cmp</span>    %ecx,%eax</span><br><span class="line">  40117f: <span class="number">75</span> f5                 <span class="keyword">jne</span>    <span class="number">401176</span> &lt;phase_6+<span class="number">0x82</span>&gt;</span><br><span class="line">  <span class="number">401181</span>: eb <span class="number">05</span>                 <span class="keyword">jmp</span>    <span class="number">401188</span> &lt;phase_6+<span class="number">0x94</span>&gt;</span><br><span class="line">  <span class="number">401183</span>: ba d0 <span class="number">32</span> <span class="number">60</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x6032d0,%edx</span><br><span class="line">  <span class="number">401188</span>: <span class="number">48</span> <span class="number">89</span> <span class="number">54</span> <span class="number">74</span> <span class="number">20</span>        <span class="keyword">mov</span>    %rdx,<span class="number">0x20</span>(%rsp,%rsi,<span class="number">2</span>)</span><br><span class="line">  <span class="number">40118d</span>: <span class="number">48</span> <span class="number">83</span> c6 <span class="number">04</span>           <span class="keyword">add</span>    <span class="number">$0</span>x4,%rsi</span><br><span class="line">  <span class="number">401191</span>: <span class="number">48</span> <span class="number">83</span> fe <span class="number">18</span>           <span class="keyword">cmp</span>    <span class="number">$0</span>x18,%rsi</span><br><span class="line">  <span class="number">401195</span>: <span class="number">74</span> <span class="number">14</span>                 <span class="keyword">je</span>     4011ab &lt;phase_6+<span class="number">0xb7</span>&gt;</span><br><span class="line">  <span class="number">401197</span>: 8b 0c <span class="number">34</span>              <span class="keyword">mov</span>    (%rsp,%rsi,<span class="number">1</span>),%ecx</span><br><span class="line">  40119a: <span class="number">83</span> f9 <span class="number">01</span>              <span class="keyword">cmp</span>    <span class="number">$0</span>x1,%ecx</span><br><span class="line">  <span class="number">40119d</span>: 7e e4                 <span class="keyword">jle</span>    <span class="number">401183</span> &lt;phase_6+<span class="number">0x8f</span>&gt;</span><br><span class="line">  40119f: b8 <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x1,%eax</span><br><span class="line">  4011a4: ba d0 <span class="number">32</span> <span class="number">60</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x6032d0,%edx</span><br><span class="line">  4011a9: eb cb                 <span class="keyword">jmp</span>    <span class="number">401176</span> &lt;phase_6+<span class="number">0x82</span>&gt;</span><br><span class="line">====================================================</span><br><span class="line">  4011ab: <span class="number">48</span> 8b 5c <span class="number">24</span> <span class="number">20</span>        <span class="keyword">mov</span>    <span class="number">0x20</span>(%rsp),%rbx</span><br><span class="line">  4011b0: <span class="number">48</span> <span class="number">8d</span> <span class="number">44</span> <span class="number">24</span> <span class="number">28</span>        <span class="keyword">lea</span>    <span class="number">0x28</span>(%rsp),%rax</span><br><span class="line">  4011b5: <span class="number">48</span> <span class="number">8d</span> <span class="number">74</span> <span class="number">24</span> <span class="number">50</span>        <span class="keyword">lea</span>    <span class="number">0x50</span>(%rsp),%rsi</span><br><span class="line">  4011ba: <span class="number">48</span> <span class="number">89</span> d9              <span class="keyword">mov</span>    %rbx,%rcx</span><br><span class="line">  4011bd: <span class="number">48</span> 8b <span class="number">10</span>              <span class="keyword">mov</span>    (%rax),%rdx</span><br><span class="line">  4011c0: <span class="number">48</span> <span class="number">89</span> <span class="number">51</span> <span class="number">08</span>           <span class="keyword">mov</span>    %rdx,<span class="number">0x8</span>(%rcx)</span><br><span class="line">  4011c4: <span class="number">48</span> <span class="number">83</span> c0 <span class="number">08</span>           <span class="keyword">add</span>    <span class="number">$0</span>x8,%rax</span><br><span class="line">  4011c8: <span class="number">48</span> <span class="number">39</span> f0              <span class="keyword">cmp</span>    %rsi,%rax</span><br><span class="line">  4011cb: <span class="number">74</span> <span class="number">05</span>                 <span class="keyword">je</span>     4011d2 &lt;phase_6+<span class="number">0xde</span>&gt;</span><br><span class="line">  4011cd: <span class="number">48</span> <span class="number">89</span> d1              <span class="keyword">mov</span>    %rdx,%rcx</span><br><span class="line">  4011d0: eb eb                 <span class="keyword">jmp</span>    4011bd &lt;phase_6+<span class="number">0xc9</span>&gt;</span><br><span class="line">  4011d2: <span class="number">48</span> c7 <span class="number">42</span> <span class="number">08</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="keyword">movq</span>   <span class="number">$0</span>x0,<span class="number">0x8</span>(%rdx)</span><br><span class="line">  4011d9: <span class="number">00</span> </span><br><span class="line">  4011da: bd <span class="number">05</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>        <span class="keyword">mov</span>    <span class="number">$0</span>x5,%ebp</span><br><span class="line">  4011df: <span class="number">48</span> 8b <span class="number">43</span> <span class="number">08</span>           <span class="keyword">mov</span>    <span class="number">0x8</span>(%rbx),%rax</span><br><span class="line">  4011e3: 8b <span class="number">00</span>                 <span class="keyword">mov</span>    (%rax),%eax</span><br><span class="line">  4011e5: <span class="number">39</span> <span class="number">03</span>                 <span class="keyword">cmp</span>    %eax,(%rbx)</span><br><span class="line">  4011e7: <span class="number">7d</span> <span class="number">05</span>                 <span class="keyword">jge</span>    4011ee &lt;phase_6+<span class="number">0xfa</span>&gt;</span><br><span class="line">  4011e9: e8 4c <span class="number">02</span> <span class="number">00</span> <span class="number">00</span>        callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  4011ee: <span class="number">48</span> 8b 5b <span class="number">08</span>           <span class="keyword">mov</span>    <span class="number">0x8</span>(%rbx),%rbx</span><br><span class="line">  4011f2: <span class="number">83</span> ed <span class="number">01</span>              <span class="keyword">sub</span>    <span class="number">$0</span>x1,%ebp</span><br><span class="line">  4011f5: <span class="number">75</span> e8                 <span class="keyword">jne</span>    4011df &lt;phase_6+<span class="number">0xeb</span>&gt;</span><br><span class="line">  4011f7: <span class="number">48</span> <span class="number">83</span> c4 <span class="number">50</span>           <span class="keyword">add</span>    <span class="number">$0</span>x50,%rsp</span><br><span class="line">  4011fb: 5b                    <span class="keyword">pop</span>    %rbx</span><br><span class="line">  4011fc: <span class="number">5d</span>                    <span class="keyword">pop</span>    %rbp</span><br><span class="line">  4011fd: <span class="number">41</span> 5c                 <span class="keyword">pop</span>    %r12</span><br><span class="line">  4011ff: <span class="number">41</span> <span class="number">5d</span>                 <span class="keyword">pop</span>    %r13</span><br><span class="line">  <span class="number">401201</span>: <span class="number">41</span> 5e                 <span class="keyword">pop</span>    %r14</span><br><span class="line">  <span class="number">401203</span>: c3                    retq</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/16480045/print-the-whole-linked-list-in-gdb">c++ - Print the whole linked list in gdb? - Stack Overflow</a></p>
<p>在分析代码的过程，我发现这段冗长的代码主要可以分为三个部分，一开始是常规的读入我们输入的六个数字，然后在第一部分将输入 input 根据值转换成新的六个数字（这里我们设其为数组 a），然后在第二部分会根据 a 的值和一个特殊地址 0x5032d0 二者得到得到六个地址（这里我们设其为数组 b，里面每个值都是一个地址），最后在第三部分判断根据 b 的地址得到的值是否满足降序排列，也就是 [b [i] ≥ b [i + 1]]。</p>
<p>下面我们逆向分析，首先通过打印 0x5032d0 处的数据不难发现，其类型为节点，而通过之前的分析，我们知道一共有 6 个节点，观察发现每个节点占四个字节：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/24w 0x6032d0</span><br><span class="line">0x6032d0 &lt;node1&gt;: 0x0000014c 0x00000001 0x006032e0 0x00000000</span><br><span class="line">0x6032e0 &lt;node2&gt;: 0x000000a8 0x00000002 0x006032f0 0x00000000</span><br><span class="line">0x6032f0 &lt;node3&gt;: 0x0000039c 0x00000003 0x00603300 0x00000000</span><br><span class="line">0x603300 &lt;node4&gt;: 0x000002b3 0x00000004 0x00603310 0x00000000</span><br><span class="line">0x603310 &lt;node5&gt;: 0x000001dd 0x00000005 0x00603320 0x00000000</span><br><span class="line">0x603320 &lt;node6&gt;: 0x000001bb 0x00000006 0x00000000 0x00000000</span><br></pre></td></tr></table></figure>
<p>经过解析得到六个节点值为 0x14c、0xa8、0x39c、0x2b3、0x1dd、0x1bb，为了让其降序排列，我们需要将其下标交换，得到 3、4、5、6、1、2，也就是 b [0] 存 node3 的地址，b [1] 存 node4 的地址，以此类推。</p>
<p>再进入第二部分，经过分析，我们发现可以分两种情况：当 a [i]≤1 时，直接让 b [i]=node1；当 a [i]&gt;1 时，会有一个变量 %edx（我们假设它是 j）从 2 到 6 遍历，直到 j 和 a [i] 相等时，让 b [i]=nodej。现在我们应该能推断，实际上 a [i] 的值应是 2~6 以及一个可能为 1 或者 0 的值，而这部分的逻辑就是 b [i]=node_a [i]，而为了得到 b=[node3，node4，node5，node6，node1，node2]，需要让 a=[3, 4, 5, 6, 0 or 1, 2]。</p>
<p>现在再分析第一部分，这部分就相对比较简单了，a [i] = 7 - input [i]，且 a [i] 两两不相等并且限制了输入数字不能大于 6，所以 a [4] 不能等于 0，综上得到 input=“4 3 2 1 6 5”</p>
<p>答案：</p>
<p>1.“Border relations with Canada have never been better.”</p>
<p>2.“1 2 4 8 16 32”</p>
<p>3.“0 207”</p>
<p>4.“0 0”</p>
<p>5.“ionefg”</p>
<p>6.“4 3 2 1 6 5”</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://earthaa.github.io/2020/01/12/CSAPP-Bomblab/">《深入理解计算机系统》Bomb Lab 实验解析 | Yi’s Blog (earthaa.github.io)</a></p>
<p><a target="_blank" rel="noopener" href="https://baiweiblog.wordpress.com/2018/05/12/cmu-15213-bomb-lab/">CMU 15213: Bomb Lab (1) | Wei Bai 白巍 (wordpress.com)</a></p>
</div><div class="article-licensing box"><div class="licensing-title"><p>CSAPP Lab2 Defusing a Binary Bomb</p><p><a href="https://zion4h.github.io/2022/06/02/CSAPP-LAB-2/">https://zion4h.github.io/2022/06/02/CSAPP-LAB-2/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>zion h4</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2022-06-02</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2025-04-19</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=641e7fdbd0e85900127dc9ed&amp;product=inline-share-buttons&amp;source=platform" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2022/06/03/CSAPP-LAB-3/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">CSAPP Lab3 Understanding Buffer Overflow Bugs</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2022/06/01/CSAPP-LAB-1/"><span class="level-item">CSAPP Lab1 Manipulating Bits</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
            id: "92201734ae61d834cd87aff908c0a55d",
            repo: "zion4h.github.io",
            owner: "zion4h",
            clientID: "6f5a7e1a8b910087187d",
            clientSecret: "24cd36d0774c992dbd5536246799438ee849c1da",
            admin: ["zion4h"],
            createIssueManually: false,
            distractionFreeMode: false,
            perPage: 10,
            pagerDirection: "last",
            
            
            enableHotKey: true,
            
        })
        gitalk.render('comment-container')</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#准备工作"><span class="level-left"><span class="level-item">1</span><span class="level-item">准备工作</span></span></a></li><li><a class="level is-mobile" href="#Phase1"><span class="level-left"><span class="level-item">2</span><span class="level-item">Phase1</span></span></a></li><li><a class="level is-mobile" href="#Phase2"><span class="level-left"><span class="level-item">3</span><span class="level-item">Phase2</span></span></a></li><li><a class="level is-mobile" href="#Phase3"><span class="level-left"><span class="level-item">4</span><span class="level-item">Phase3</span></span></a></li><li><a class="level is-mobile" href="#Phase4"><span class="level-left"><span class="level-item">5</span><span class="level-item">Phase4</span></span></a></li><li><a class="level is-mobile" href="#Phase5"><span class="level-left"><span class="level-item">6</span><span class="level-item">Phase5</span></span></a></li><li><a class="level is-mobile" href="#Phase6"><span class="level-left"><span class="level-item">7</span><span class="level-item">Phase6</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/kitty.png" alt="Blowin&#039; in the Wind" height="28"></a><p class="is-size-7"><span>&copy; 2025 zion h4</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><i></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/zion4h"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>